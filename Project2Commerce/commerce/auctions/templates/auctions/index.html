{% extends "auctions/layout.html" %}
{% load util %}

{% block body %}
    <h2>Active Listings</h2>
    {% for listing in listings %}
        <table class="table table-striped table-bordered">
            <tbody>
                <tr>
                    <th>Title: {{ listing.title }}</th>
                    <td>Description: {{ listing.description }}</td>
                    
                    <!-- Group Bid objects of listing by amount (i.e., create a list of groups, each group has the same Bid.amount) -->
                    {% regroup listing.listingBids.all by amount as bids %}
                    
                    <!-- Ensure there are bids -->
                    {% if bids %}
                        <!-- Assign maxBid to the max bid (i.e., to the group of the max Bid.amount) -->
                        {% with maxBid=bids|max %}
                            <!-- maxBid.grouper: the value that the group is grouped by  -->
                            <td>Highest bid: {{ maxBid.grouper }}</td>
                        {% endwith %}

                    <!-- There are no bids -->
                    {% else %}
                        <td>Starting bid: {{ listing.startingBid }}</td>
                    {% endif %}
                    
                    <td>Image: <img src="{{listing.imgURL}}" width="200"></td>
                    <td>Category: {{ listing.category }}</td>
                <tr>
            </tbody>
        </table>
    {% empty %}
        <p>No listings.</p>
    {% endfor %}
{% endblock %}